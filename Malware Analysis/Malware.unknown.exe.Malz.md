<br>

# Static Analysis
----
Strings -

		Floss.exe <malware name>

![[Pasted image 20230807000856.png]]
Interesting strings-

```
HttpRequestError
httpclient.nim
newConnection
ProtocolError
@HTTP/
@Proxy-Authorization: basic 
@Connection: Keep-Alive
@Connection
@Host: 
@Host
@ HTTP/1.1
@User-Agent
@user-agent
@tables.nim(1144, 13) `len(t) == L` the length of the table changed while 
iterating over it
@Content-Length
@Nim httpclient/1.6.2
@Desktop\cosmo.jpeg
```
This malware is written in <span style="color:#7030a0">nim</span>.
Now opening the file in <span style="color:#ffff00">peview</span>.
![[Pasted image 20230807001307.png]]
Malware is a windows portable executable.
![[Pasted image 20230807001401.png]]
It is also a 32 bit executable.
![[Pasted image 20230807001436.png]]
The values of vuirtual size and size of raw data aren't the same. So this is a packed executable.
![[Pasted image 20230807001536.png]]
The lack of IATs confirm that the malware is a packed executable.
Now opening the file in <span style="color:#ffff00">pestudio</span>.
![[Pasted image 20230807001658.png]]
The malware has 5 suspicious imports-->
![[Pasted image 20230807001814.png]]
Now we move onto dynamic analysis.
<br>

# Dynamic Analysis
---
##### Without Network-
![[Pasted image 20230807002335.png]]
Nothing seems to happen.

##### With Network-
The malware sends a request for the dns address- `hey.youup.local`
![[Pasted image 20230807002811.png]]
The malware then continually makes http requests to that domain.
![[Pasted image 20230807002935.png]]
Maybe the malware is trying to exfiltrate data.
Now we use <span style="color:#ffff00">tcpview</span> to get host based network indicators.
![[Pasted image 20230807003509.png]]
The malware is making a lot of connections to the previous domain.
Now using <span style="color:#ffff00">procmon</span>.Adding some filters-->
![[Pasted image 20230807003820.png]]
We get a list of processes created by the malware.
![[Pasted image 20230807004418.png]]
We turn off inetsim and start <span style="color:#ffff00">fakedns</span>. 

		sudo fakedns

![[Pasted image 20230807005416.png]]
we get dns requests for - `[*].cosmosfurbootsemporium.local`
<br>

# Conclusion
---
![[Pasted image 20230807005538.png]]

yara rule -

```
rule malware_unknown {
    meta:
        description = "Detects the Malware.Unknown.exe provided as part of the PMAT course"
        md5 = "812a7c7eb9d7a4332b9e166aa09284d7"
        sha1 = "ec0d565afe635c2c7863b2a05df8a49c58b703a3"
        filename = "Malware.unknown.exe.malz"
        author = "Dirk F."

	Block = true
	Log = true
	Quarantine = false

    strings:
        $malware_user_agent = "httpclient/1.6.2"
        $malware_exfil_file = "Desktop\cosmo.jpeg"
        $malware_kill_switch_url = "hwtwtwpw:w/w/whwewyw.wywowuwuwpw.wlwowcwawlw"
        $malware_exfil_domain = "@.BcBoBsBmBoBsBfBuBrBbBoBoBtBsBeBmBpBoBrBiBuBmB.BlBoBcBaBlB"

    condition:
        IsPeFile and 
        all of ($malware*)
```