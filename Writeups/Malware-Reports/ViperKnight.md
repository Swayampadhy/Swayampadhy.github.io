Malware type -<span style="color:#c00000"> Ransomware Cryptoworm</span>

Hashes--->
md5-`5B1DE907E275300FFD9A931CF42D0E36`
sha256-`69BB81A8FF5522FDDFA253B908BABCB1D7B745FD2BC70E5CB85F38EE7CE24A1D`
<br>

# Initial Detonation
----
![[Pasted image 20230821000624.png]]
A console window pops up.
![[Pasted image 20230821000648.png]]
Files in the desktop folder are encryped.
![[Pasted image 20230821000733.png]]
A readme appears -
```
[Ransomware.Viper.A]

Q. 1> WhAt tHe HeCK HapPEneD To mY fIlES?!
 A > Your files were encrypted by Viper Ransomware with military grade encryption AES-256.
 There is no way to brute force it since quantum computers aren't that fast.

Q. 2>How to get back my files?
A > Add Maschinenpistole 40#6508 to your friends in https://discord.com and wait for instructions.

**NOTE** VIPER WAS CREATED FOR FUN AND NO PAYMENT IS REQUIRED, JUST CONTACT ME AND I WILL SEND YOU THE DECRYPTER. **DO NOT MODIFY THE FILES YOU IDIOT!!**
```

So the files are enctypted in AES-256.
After some time the window automatically closes.
This seems to be a ransomware.
<br>

# Static Analysis
---
### Strings-
![[Pasted image 20230821171800.png]]

Interesting Strings -
```
.NETFramework,Version=v4.7.2
FrameworkDisplayName
.NET Framework 4.7.2
$0b9b31ed-b23a-4653-82b0-7a61453ef529
C:\Users\Admin\source\repos\ConsoleApp1\ConsoleApp1\obj\Debug\ConsoleApp1.pdb
_CorExeMain
mscoree.dll
C:\Users\
ViperKnight
OFRna73m*aze01xY
RansomwareViper
\AppData
\Viper_README.RW-SK.txt
Microsoft-USB-Security.exe
```
This malware seems to reside in the .NET framework . So it must be written in C# or F#.

### IAT Analysis -

![[Pasted image 20230821172354.png]]
This is a PE file.
![[Pasted image 20230821173853.png]]
The values of size of <span style="color:#047c3a">raw data</span> and <span style="color:#047c3a">virtual size</span> aren't equal. This is a packed malware.
![[Pasted image 20230821174032.png]]
![[Pasted image 20230821174008.png]]
The lack of imports confirm this.

### Pestudio

![[Pasted image 20230821174216.png]]
![[Pasted image 20230821174332.png]]
Pestudio's malicious indicators.
Suspected imports -
![[Pasted image 20230821174431.png]]

Opening the malware in cutter -
![[Pasted image 20230821174612.png]]
The malware is apparently written in `cil`.

### Source code analysis-

Opening the malware in <span style="color:#ffff00">dnspy</span>-
![[Pasted image 20230821174936.png]]

The main source code -
![[Pasted image 20230821175135.png]]
![[Pasted image 20230821175147.png]]
![[Pasted image 20230821175203.png]]
![[Pasted image 20230821175214.png]]
![[Pasted image 20230821175233.png]]
So the malware first gets the list of devices and puts them in an array -
![[Pasted image 20230821175350.png]]
Then if the device is removable or connected to a network , then it spreads to it as a file named - `Microsoft-USB-Security.exe`.
![[Pasted image 20230821175612.png]]
![[Pasted image 20230821175624.png]]
Else the encrypt function `encryptAllDirectoryAndSubDirectoryFiles` is called.
![[Pasted image 20230821175913.png]]
Now this function is a recursive function. In every folder it calls the `encrypt` function and writes the readme text file. 
![[Pasted image 20230821180134.png]]
![[Pasted image 20230821180505.png]]
The above function calls upon Encrypt function to do the actual encryption. This function seems to read all files and encrypt it using SHA1.

![[Pasted image 20230821180712.png]]

The encryption vector is - `OFRna73m*aze01xY`.
<br>

# Dynamic Analysis
----
### Network Based Indicators-

![[Pasted image 20230821181154.png]]
The malware is broadcasting net-bios requests to spread to other computers.
<br>

### Host Based Indicators-

Procmon -

![[Pasted image 20230821182522.png]]
![[Pasted image 20230821182652.png]]
![[Pasted image 20230821182804.png]]
![[Pasted image 20230821182814.png]]

