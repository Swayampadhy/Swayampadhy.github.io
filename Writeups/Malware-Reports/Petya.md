Malware type - <span style="color:#c00000">Ransomware</span>
Hashes--->
md5-`AF2379CC4D607A45AC44D62135FB7015`
sha256-`26B4699A7B9EEB16E76305D843D4AB05E94D43F3201436927E13B3EBAFA90739`
<br>

# Initial Detonation
----
![[Pasted image 20230816234336.png]]
On starting the malware, the system crashes and a disk checker pops up.
![[Pasted image 20230816234504.png]]
![[Pasted image 20230816234530.png]]
It asks for a key to unlock the data.
![[Pasted image 20230816234640.png]]
<br>

# Static Analysis
----
 Strings -
![[Pasted image 20230817104837.png]]

Interesting strings -

```
SYSTEM
Google Update
GoogleUpdate.exe
S-1-5-18
SYSTEM\CurrentControlSet\Control\Session Manager
PendingFileRenameOperations
AHKEY_CLASSES_ROOT
HKEY_USERS
HKEY_CURRENT_USER
HKEY_LOCAL_MACHINE
@\VarFileInfo\Translation
**SehSendMinidump**
sprintf failure
Exception %x in %s %s %u
%hs:%d
Exception
@APPDATA
DESKTOP
LOCALAPPDATA
MYMUSIC
MYPICTURES
PROGRAMFILES
PROGRAMFILESCOMMON
PROGRAMS
STARTMENU
STARTUP
WINDOWS
@CommandLineMode
HKLM\Software\Microsoft\Windows NT\CurrentVersion\NetworkCards
```
Now opening in <span style="color:#ffff00">peview</span>-
![[Pasted image 20230817111338.png]]
windows PE file.
![[Pasted image 20230817112212.png]]
This is an unpacked binary.
Now opening in <span style="color:#ffff00">pestudio</span>.
![[Pasted image 20230817181224.png]]
![[Pasted image 20230817181246.png]]
![[Pasted image 20230817181320.png]]
![[Pasted image 20230817181343.png]]
![[Pasted image 20230817181403.png]]

The manifest file -

```
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
<assemblyIdentity
  version="1.0.0.0"
  processorArchitecture="*"
  name="WinRAR SFX"
  type="win32"/>
<description>WinRAR SFX module</description>
<trustInfo xmlns="urn:schemas-microsoft-com:asm.v2">
  <security>
    <requestedPrivileges>
      <requestedExecutionLevel level="requireAdministrator"            
      uiAccess="false"/>
    </requestedPrivileges>
  </security>
</trustInfo>
<dependency>
  <dependentAssembly>
    <assemblyIdentity
      type="win32"
      name="Microsoft.Windows.Common-Controls"
      version="6.0.0.0"
      processorArchitecture="*"
      publicKeyToken="6595b64144ccf1df"
      language="*"/>
  </dependentAssembly>
</dependency>
<compatibility xmlns="urn:schemas-microsoft-com:compatibility.v1">
  <application>
    <!--The ID below indicates application support for Windows Vista -->
      <supportedOS Id="{e2011457-1546-43c5-a5fe-008deee3d3f0}"/>
    <!--The ID below indicates application support for Windows 7 -->
      <supportedOS Id="{35138b9a-5d96-4fbd-8e2d-a2440225f93a}"/>
    <!--The ID below indicates application support for Windows 8 -->
      <supportedOS Id="{4a2f28e3-53b9-4441-ba9c-d69d4a4a6e38}"/>
    <!--The ID below indicates application support for Windows 8.1 -->
      <supportedOS Id="{1f676c76-80e1-4239-95bb-83d0f6d0da78}"/>
    <!--The ID below indicates application support for Windows 10 -->
      <supportedOS Id="{8e0f7a12-bfb3-4fe8-b9a5-48fd50a15a9a}"/>
  </application>
</compatibility>
<asmv3:application xmlns:asmv3="urn:schemas-microsoft-com:asm.v3">
  <asmv3:windowsSettings xmlns="http://schemas.microsoft.com/SMI/2005/WindowsSettings">
    <dpiAware>true</dpiAware>
  </asmv3:windowsSettings>
</asmv3:application>
</assembly>
```
<br>

# Dynamic Analysis
---
### Network based indicators

![[Pasted image 20230820214726.png]]
![[Pasted image 20230820214926.png]]
No network signatures created by the malware.

### Host-based indicators

![[Pasted image 20230820221414.png]]
The entry-point of the malware-
the `a.419303` function
![[Pasted image 20230820221530.png]]

and `a.416FF8` function
![[Pasted image 20230820221608.png]]
then `a.4177f0` function -
![[Pasted image 20230820225821.png]]
![[Pasted image 20230820225947.png]]
The malware is loading the above dll at the time of windows crash.
![[Pasted image 20230820230120.png]]
Now using <span style="color:#ffff00">procmon</span> -
![[Pasted image 20230820230300.png]]
![[Pasted image 20230820230328.png]]
The malware creates a new device for itself.
![[Pasted image 20230820231723.png]]
![[Pasted image 20230820231803.png]]
It is using ntdll functions.
![[Pasted image 20230820231929.png]]
![[Pasted image 20230820231948.png]]
![[Pasted image 20230820232000.png]]
![[Pasted image 20230820232009.png]]
![[Pasted image 20230820232022.png]]
<br>

# Conclusion
------
This malware when run spawns another process which runs `bcryptprimitives.dll` to encrypt windows contents.